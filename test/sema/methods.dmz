// RUN: compiler %s -res-dump 2>&1 | filecheck %s

extern fn printf(fmt:*u8, ...) -> i32;

struct Color {
    r: i32,
    g: i32,
    b: i32,
    
    fn print(self:&Color) -> i32 {
        return printf("Color{%d, %d, %d}\n", self.r, self.g, self.b);
    }
}

// CHECK: ResolvedMemberFunctionDecl
// CHECK-NEXT:   ResolvedStructDecl Struct Color
// CHECK-NEXT:   ResolvedFunctionDecl print -> Int i32
// CHECK-NEXT:     ResolvedParamDecl:Struct &Color self
// CHECK-NEXT:     ResolvedBlock
// CHECK-NEXT:       ResolvedReturnStmt
// CHECK-NEXT:         ResolvedCallExpr:Int i32
// CHECK-NEXT:           ResolvedExternFunctionDecl printf -> Int i32
// CHECK-NEXT:           ResolvedStringLiteral:UInt u8[19] 'Color{%d, %d, %d}\n'
// CHECK-NEXT:           ResolvedMemberExpr:Int i32 r
// CHECK-NEXT:             ResolvedDeclRefExpr:Struct &Color self
// CHECK-NEXT:           ResolvedMemberExpr:Int i32 g
// CHECK-NEXT:             ResolvedDeclRefExpr:Struct &Color self
// CHECK-NEXT:           ResolvedMemberExpr:Int i32 b
// CHECK-NEXT:             ResolvedDeclRefExpr:Struct &Color self

fn main() -> void {
    let c:Color = Color{r:1, g:2, b:3};
    c.print(); 
}
// CHECK: ResolvedFunctionDecl main -> Void void
// CHECK-NEXT:   ResolvedBlock
// CHECK-NEXT:     ResolvedDeclStmt
// CHECK-NEXT:       ResolvedVarDecl:Struct Color c
// CHECK-NEXT:         ResolvedStructInstantiationExpr:Struct Color
// CHECK-NEXT:           ResolvedFieldInitStmt:Int i32 r
// CHECK-NEXT:             ResolvedIntLiteral:Int i32 '1'
// CHECK-NEXT:             | value: 1
// CHECK-NEXT:           ResolvedFieldInitStmt:Int i32 g
// CHECK-NEXT:             ResolvedIntLiteral:Int i32 '2'
// CHECK-NEXT:             | value: 2
// CHECK-NEXT:           ResolvedFieldInitStmt:Int i32 b
// CHECK-NEXT:             ResolvedIntLiteral:Int i32 '3'
// CHECK-NEXT:             | value: 3
// CHECK-NEXT:     ResolvedCallExpr:Int i32
// CHECK-NEXT:       ResolvedFunctionDecl print -> Int i32
// CHECK-NEXT:       ResolvedRefPtrExpr:Struct &Color
// CHECK-NEXT:         ResolvedDeclRefExpr:Struct Color c