// RUN: (dmz %s -res-dump 2>&1 || true) | filecheck %s

extern fn printf(fmt: *u8, ...) -> i32;

struct Color {
    r: i32,
    g: i32,
    b: i32,

    pub fn print(self: *@This) -> i32 {
        return printf("Color{%d, %d, %d}\n", self.r, self.g, self.b);
    }
}
// CHECK:       ResolvedMemberFunctionDecl print fn(*methods.Color{})->i32
// CHECK-NEXT:         ResolvedParamDecl:*methods.Color 
// CHECK-NEXT:         ResolvedBlock
// CHECK-NEXT:           ResolvedReturnStmt
// CHECK-NEXT:             ResolvedCallExpr:i32
// CHECK-NEXT:               ResolvedDeclRefExpr:fn(*u8, ...)->i32 printf
// CHECK-NEXT:               ResolvedStringLiteral:*u8 'Color{%d, %d, %d}\n'
// CHECK-NEXT:               ResolvedMemberExpr:i32 r
// CHECK-NEXT:                 ResolvedDerefPtrExpr:methods.Color{}
// CHECK-NEXT:                   ResolvedDeclRefExpr:*methods.Color{} self
// CHECK-NEXT:               ResolvedMemberExpr:i32 g
// CHECK-NEXT:                 ResolvedDerefPtrExpr:methods.Color{}
// CHECK-NEXT:                   ResolvedDeclRefExpr:*methods.Color{} self
// CHECK-NEXT:               ResolvedMemberExpr:i32 b
// CHECK-NEXT:                 ResolvedDerefPtrExpr:methods.Color{}
// CHECK-NEXT:                   ResolvedDeclRefExpr:*methods.Color{} self

fn main() -> void {
    let c: Color = Color{r: 1, g: 2, b: 3};
    c.print();
}

// CHECK: ResolvedFunctionDecl main fn()->void
// CHECK-NEXT:   ResolvedBlock
// CHECK-NEXT:     ResolvedDeclStmt
// CHECK-NEXT:       ResolvedVarDecl:methods.Color{} c
// CHECK-NEXT:         ResolvedStructInstantiationExpr:methods.Color{}
// CHECK-NEXT:           ResolvedFieldInitStmt:i32 r
// CHECK-NEXT:             ResolvedIntLiteral:i32 '1'
// CHECK-NEXT:             | value: 1
// CHECK-NEXT:           ResolvedFieldInitStmt:i32 g
// CHECK-NEXT:             ResolvedIntLiteral:i32 '2'
// CHECK-NEXT:             | value: 2
// CHECK-NEXT:           ResolvedFieldInitStmt:i32 b
// CHECK-NEXT:             ResolvedIntLiteral:i32 '3'
// CHECK-NEXT:             | value: 3
// CHECK-NEXT:     ResolvedCallExpr:i32
// CHECK-NEXT:       ResolvedMemberExpr:fn(*methods.Color{})->i32 print
// CHECK-NEXT:         ResolvedDeclRefExpr:methods.Color{} c
// CHECK-NEXT:       ResolvedRefPtrExpr:*methods.Color{}
// CHECK-NEXT:         ResolvedDeclRefExpr:methods.Color{} c